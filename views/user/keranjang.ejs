<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keranjang</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>

<body>
    <div class="container mt-5">
        <h1 class="text-center text-primary mb-4">Keranjang Belanja</h1>

        <!-- Tombol kembali ke Dashboard -->
        <a href="/user/dashboard" class="btn btn-secondary mb-3">Kembali ke Dashboard</a>

        <div class="row" id="cart-items-container">
            <!-- Data keranjang akan dimuat di sini dengan JS -->
        </div>

        <!-- Total Harga -->
        <h4 class="mt-4">Total: Rp <span id="total-harga">0</span></h4>

        <form action="/user/transaksi" method="POST" id="checkout-form">
            <input type="hidden" name="id" value="<%= user.id %>">
            <input type="hidden" name="ID_Paket" id="ID_Paket">
            <input type="hidden" name="Jumlah_Pembayaran" id="Jumlah_Pembayaran">
            <button type="button" class="btn btn-success mt-3" onclick="checkout()">Checkout</button>
        </form>
    </div>

    <!-- JavaScript untuk Menampilkan Data dari Local Storage -->
    <script>
        const keranjang = JSON.parse(localStorage.getItem('keranjang')) || [];
        const cartContainer = document.getElementById('cart-items-container');
        const totalHargaElement = document.getElementById('total-harga');

        function renderCart() {
            cartContainer.innerHTML = '';
            let totalHarga = 0;

            keranjang.forEach((item, index) => {
                totalHarga += item.Harga;
                cartContainer.innerHTML += `
                    <div class="col-md-4 mb-4">
                        <div class="card">
                            <img src="${item.Gambar}" class="card-img-top" alt="Gambar Paket ${item.Nama_paket}">
                            <div class="card-body">
                                <h5 class="card-title">${item.Nama_paket}</h5>
                                <p class="text-success font-weight-bold">Rp ${item.Harga}</p>
                                <button class="btn btn-danger" onclick="removeFromCart(${index})">Hapus</button>
                            </div>
                        </div>
                    </div>
                `;
            });

            totalHargaElement.innerText = totalHarga;
        }

        function removeFromCart(index) {
            keranjang.splice(index, 1);
            localStorage.setItem('keranjang', JSON.stringify(keranjang));
            renderCart();
        }

        function checkout() {
            if (keranjang.length === 0) {
                alert('Keranjang kosong! Tambahkan paket terlebih dahulu.');
                return;
            }

            const paket = keranjang[0];
            document.getElementById('ID_Paket').value = paket.ID_Paket;
            document.getElementById('Jumlah_Pembayaran').value = paket.Harga;

            document.getElementById('checkout-form').submit();
        }

        renderCart();
    </script>
</body>

</html>